<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>VIEWSHORT ‚Äî Premium</title>
<style>
:root{--bg:#07101a;--card:#071829;--accent:#06b6d4;--muted:#9aa4b2;--text:#e6f7fb}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#04101a,#06121a);color:var(--text);font-family:Inter,Segoe UI,Roboto,Arial}
.app{max-width:980px;margin:0 auto;padding:18px}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px}
.title{font-size:20px;font-weight:800}
.search{display:flex;gap:8px;margin:14px 0}
.search input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:var(--text)}
.search button{padding:10px 14px;border-radius:10px;border:none;background:var(--accent);color:#042027;font-weight:700}
.filters{display:flex;gap:8px;margin-bottom:14px}
.filter-btn{padding:8px 12px;border-radius:10px;border:none;background:transparent;color:var(--muted);cursor:pointer}
.filter-btn.active{background:var(--accent);color:#042027}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
.card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,10,.6);cursor:pointer;transition:transform .15s ease}
.card:hover{transform:translateY(-6px)}
.thumb{width:100%;aspect-ratio:9/16;object-fit:cover;display:block;background:#000}
.card .meta{padding:8px}
.card .meta .t{font-weight:700;font-size:13px;color:var(--text);line-height:1.1}
.card .meta .c{font-size:12px;color:var(--muted);margin-top:6px}
.controls{display:flex;justify-content:center;gap:12px;margin:18px 0}
.pag-btn{padding:8px 12px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:var(--text);cursor:pointer}
.loader{display:flex;align-items:center;justify-content:center;padding:40px;color:var(--muted)}
.footer{margin-top:24px;color:var(--muted);font-size:13px;text-align:center}
@media (max-width:420px){.app{padding:12px}.title{font-size:18px}}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="title">üé¨ VIEWSHORT Premium</div>
    <div style="font-size:13px;color:var(--muted)">Powered by Supabase</div>
  </div>

  <div class="search">
    <input id="searchInput" placeholder="Cari Judul üîç" />
    <button id="searchBtn">üîé</button>
  </div>

  <div class="filters">
    <button class="filter-btn active" data-cat="terbaru">Terbaru</button>
    <button class="filter-btn" data-cat="populer">Populer</button>
  </div>

  <div id="videoGrid" class="grid"></div>

  <div class="controls">
    <button id="prevPage" class="pag-btn">‚¨ÖÔ∏è Sebelumnya</button>
    <div id="pageInfo" style="align-self:center;color:var(--muted)">Page 1</div>
    <button id="nextPage" class="pag-btn">Selanjutnya ‚û°Ô∏è</button>
  </div>

  <div id="loader" class="loader">Memuat...</div>
  <div class="footer">¬© VIEWSHORT ‚Äî gunakan bertanggung jawab</div>
</div>

<!-- Supabase client -->
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const SUPABASE_URL = "https://okqfnesvaetbljnzywvx.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9rcWZuZXN2YWV0Ymxqbnp5d3Z4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MjM0MTgsImV4cCI6MjA3Nzk5OTQxOH0.h3Z7bOJEBywZYHzwBSGScrvpXaDgNqHcXccLTkXjbhc";
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

let currentCategory = 'terbaru';
let searchQuery = '';
let page = 1;
const PAGE_SIZE = 12;

const grid = document.getElementById('videoGrid');
const loader = document.getElementById('loader');
const pageInfo = document.getElementById('pageInfo');

document.getElementById('searchBtn').addEventListener('click', ()=>{
  searchQuery = document.getElementById('searchInput').value.trim();
  page = 1; fetchAndRender();
});

document.querySelectorAll('.filter-btn').forEach(b=>{
  b.addEventListener('click', (e)=>{
    document.querySelectorAll('.filter-btn').forEach(x=>x.classList.remove('active'));
    e.currentTarget.classList.add('active');
    currentCategory = e.currentTarget.dataset.cat;
    page = 1; fetchAndRender();
  });
});

document.getElementById('prevPage').addEventListener('click', ()=>{ if(page>1){page--; fetchAndRender();}});
document.getElementById('nextPage').addEventListener('click', ()=>{ page++; fetchAndRender();});

async function fetchAndRender(){
  loader.style.display='flex';
  grid.innerHTML='';
  pageInfo.textContent = `Page ${page}`;

  try{
    let query = supabase.from('videos').select('*').order('part', {ascending:true});
    if(currentCategory) query = query.eq('category', currentCategory);
    if(searchQuery) query = query.ilike('title', `%${searchQuery}%`);

    const from = (page-1)*PAGE_SIZE;
    const to = from + PAGE_SIZE - 1;
    const { data, error } = await query.range(from, to);
    if(error) throw error;

    if(!data || data.length===0){
      grid.innerHTML = '<div style="grid-column:1/-1;padding:40px;text-align:center;color:var(--muted)">Tidak ada video.</div>';
    } else {
      data.forEach(v => {
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `
          <img class="thumb" src="${v.thumbnail}" alt="${v.title}">
          <div class="meta">
            <div class="t">${v.title}</div>
            <div class="c">Part ${v.part || 1} ‚Ä¢ ${v.category || ''}</div>
          </div>`;
        div.onclick = ()=> window.location.href = \`detail.html?id=\${encodeURIComponent(v.id)}\`;
        grid.appendChild(div);
      });
    }
  }catch(err){
    console.error('Error fetching:', err);
    grid.innerHTML = '<div style="grid-column:1/-1;padding:40px;text-align:center;color:#ffb3b3">Gagal mengambil data.</div>';
  } finally{
    loader.style.display='none';
  }
}

fetchAndRender();
</script>

</body>
</html>
